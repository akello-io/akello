version: "3"
services:
  redis:
      image: redis:6.2-alpine
      restart: always
      ports:
        - '6379:6379'
      command: redis-server
      network_mode: bridge
      volumes:
        - cache:/data
  cognito-local:
    image: jagregory/cognito-local:latest
    volumes:
      - ./.cognito:/app/.cognito
      #- ${COGNITO_PATH}:/app/.cognito
    ports:
      - "9229:9229"
    environment:
      - CODE=1234
  graphql:
    environment:
      DYNAMODB_URL: ${DYNAMODB_URL}
      AWS_REGION: ${AWS_REGION}
      AWS_PROFILE: ${AWS_PROFILE}
    build:
      context: ./graphql
      dockerfile: ./Dockerfile
    ports:
      - "8000:8000"
    volumes:
      - ~/.aws/:/root/.aws:ro
    network_mode: bridge
    extra_hosts:
      - "host.docker.internal:host-gateway"
  measurement-based-care:
    environment:
      DYNAMODB_URL: ${DYNAMODB_URL}
      AWS_REGION: ${AWS_REGION}
      AWS_PROFILE: ${AWS_PROFILE}
    depends_on:
      - redis
    build:
      context: ./microservices/clinical-model-measurement-based-care
      dockerfile: ./Dockerfile
    ports:
      - "8010:8000"
    volumes:
      - ~/.aws/:/root/.aws:ro
    network_mode: bridge
    extra_hosts:
      - "host.docker.internal:host-gateway"

volumes:
  cache:
    driver: local